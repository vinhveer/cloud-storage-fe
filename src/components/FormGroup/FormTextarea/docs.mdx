import React from 'react'
import FormTextarea from '@/components/FormGroup/FormTextarea/FormTextarea'
import FormGroup from '@/components/FormGroup/FormGroup'

# FormTextarea

Textarea. Label/help/error được cung cấp bởi `FormGroup`.

## Mục đích & trường hợp xử lý

- Nhập nội dung văn bản dài (mô tả, ghi chú).

## Props

| Tên | Kiểu | Mặc định | Mô tả |
| --- | --- | --- | --- |
| placeholder | `string` | `''` | Gợi ý nội dung |
| rows | `number` | `4` | Số hàng hiển thị |
| className | `string` | - | Bổ sung class Tailwind |
| ...rest | `Omit&lt;React.TextareaHTMLAttributes&lt;HTMLTextAreaElement&gt;, 'placeholder' &#124; 'rows'&gt;` | - | Thuộc tính textarea gốc |

### Props mở rộng (Rich text)

> Cần cài `@tinymce/tinymce-react` và `tinymce` (đã được thêm)

| Tên | Kiểu | Mặc định | Mô tả |
| --- | --- | --- | --- |
| rich | `boolean` | `false` | Bật TinyMCE editor |
| height | `number` | `auto` | Chiều cao editor; mặc định dựa vào `rows` |
| editorInit | `Record<string, unknown>` | `{}` | Ghi đè cấu hình TinyMCE |
| onValueChange | `(value: string) => void` | - | Nhận HTML khi thay đổi |

## Cách dùng

```tsx
import FormGroup from '@/components/FormGroup/FormGroup'
import FormTextarea from '@/components/FormGroup/FormTextarea/FormTextarea'

<FormGroup label="Ghi chú" help="Bạn có thể cập nhật sau.">
  <FormTextarea placeholder="Nhập ghi chú..." rows={6} />
</FormGroup>
```

Rich (TinyMCE):

```tsx
<FormGroup label="Mô tả (rich)">
  <FormTextarea rich rows={12} placeholder="Nhập mô tả..." />
</FormGroup>
```

### Demos

```tsx
import FormTextarea from '@/components/FormGroup/FormTextarea/FormTextarea'
```

#### Cơ bản

```tsx
<>
  <FormGroup label="Ghi chú">
    <FormTextarea placeholder="Nhập ghi chú..." />
  </FormGroup>
  <FormGroup label="Mô tả">
    <FormTextarea rows={6} />
  </FormGroup>
</>
```

<div className="grid gap-4">
  <FormGroup label="Ghi chú">
    <FormTextarea placeholder="Nhập ghi chú..." />
  </FormGroup>
  <FormGroup label="Mô tả">
    <FormTextarea rows={6} />
  </FormGroup>
</div>

#### Trạng thái

```tsx
{(() => {
  const [value, setValue] = React.useState('')
  return (
    <div className="grid gap-4">
      <FormGroup label="Controlled" help="Ví dụ controlled">
        <FormTextarea placeholder="Nhập nội dung" value={value} onChange={(e) => setValue(e.target.value)} />
      </FormGroup>
      <FormGroup label="Có lỗi" error="Nội dung không hợp lệ">
        <FormTextarea />
      </FormGroup>
    </div>
  )
})()}
```

{(() => {
  const [value, setValue] = React.useState('')
  return (
    <div className="grid gap-4">
      <FormGroup label="Controlled" help="Ví dụ controlled">
        <FormTextarea placeholder="Nhập nội dung" value={value} onChange={(e) => setValue(e.target.value)} />
      </FormGroup>
      <FormGroup label="Có lỗi" error="Nội dung không hợp lệ">
        <FormTextarea />
      </FormGroup>
    </div>
  )
})()}

### Rich text (TinyMCE)

#### Bật rich editor (uncontrolled)

```tsx
<FormGroup label="Mô tả">
  <FormTextarea rich placeholder="Nhập mô tả..." rows={12} />
</FormGroup>
```

<FormGroup label="Mô tả">
  <FormTextarea rich placeholder="Nhập mô tả..." rows={12} />
</FormGroup>

#### Controlled + đồng bộ state

```tsx
{(() => {
  const [content, setContent] = React.useState('<p>Nội dung ban đầu</p>')
  return (
    <FormGroup label="Mô tả (controlled)">
      <FormTextarea
        rich
        rows={12}
        value={content}
        onValueChange={setContent}
        placeholder="Nhập mô tả..."
      />
      <div className="text-xs text-gray-500 mt-2">Độ dài HTML: {content.length}</div>
    </FormGroup>
  )
})()}
```

#### Tuỳ chỉnh toolbar/plugins

```tsx
<FormGroup label="Mô tả (custom toolbar)">
  <FormTextarea
    rich
    rows={12}
    editorInit={{
      plugins: 'link lists code table autoresize',
      toolbar: 'undo redo | styles | bold italic underline | bullist numlist | link table | code',
      menubar: false,
      statusbar: false,
    }}
  />
</FormGroup>
```

<FormGroup label="Mô tả (custom toolbar)">
  <FormTextarea
    rich
    rows={12}
    editorInit={{
      plugins: 'link lists code table autoresize',
      toolbar: 'undo redo | styles | bold italic underline | bullist numlist | link table | code',
      menubar: false,
      statusbar: false,
    }}
  />
</FormGroup>

#### Kết hợp FormGroup (error/help)

```tsx
{(() => {
  const [content, setContent] = React.useState('')
  const invalid = content.replace(/<[^>]*>/g, '').trim().length < 10
  return (
    <FormGroup label="Mô tả ngắn" error={invalid ? 'Tối thiểu 10 ký tự (không tính HTML)' : undefined} help="Bạn có thể dán HTML.">
      <FormTextarea rich rows={8} value={content} onValueChange={setContent} />
    </FormGroup>
  )
})()}
```
{(() => {
  const [content, setContent] = React.useState('')
  const invalid = content.replace(/<[^>]*>/g, '').trim().length < 10
  return (
    <FormGroup  label="Mô tả ngắn" error={invalid ? 'Tối thiểu 10 ký tự (không tính HTML)' : undefined} help="Bạn có thể dán HTML.">
      <FormTextarea rich rows={8} value={content} onValueChange={setContent} />
    </FormGroup>
  )
})()}

## Lưu ý

- `FormGroup` thiết lập `aria-invalid`/`aria-describedby` cho `FormTextarea` qua context.
- Dùng `rows` để đặt chiều cao mặc định; thành phần đã `resize-none` để cố định.
- Với `rich`, nội dung là HTML string; lưu xuống backend dưới dạng HTML hoặc chuyển Markdown tuỳ nhu cầu.
- Có thể điều chỉnh `height` để cố định chiều cao editor thay vì auto.


